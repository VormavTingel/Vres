<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VR Sala de Matemática</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
  <a-scene>
    <!-- Configuração da câmera em primeira pessoa -->
    <a-camera id="player" position="0 1.6 0" wasd-controls="enabled: true" look-controls></a-camera>

    <!-- Configuração da sala -->
    <a-box position="0 0 -5" rotation="0 0 0" width="10" height="10" depth="0.1" color="#808080"></a-box>
    <a-box position="0 0 5" rotation="0 180 0" width="10" height="10" depth="0.1" color="#808080"></a-box>
    <a-box position="5 0 0" rotation="0 -90 0" width="10" height="10" depth="0.1" color="#808080"></a-box>
    <a-box position="-5 0 0" rotation="0 90 0" width="10" height="10" depth="0.1" color="#808080"></a-box>
    <a-plane position="0 -5 0" rotation="-90 0 0" width="10" height="10" color="#ffffff"></a-plane>

    <!-- NPC com dimensões especificadas -->
    <a-gltf-model id="npc" src="bobby.glb" position="1 -5 -4" scale="5 5 5" rotation="0 -90 0"></a-gltf-model>

    <!-- Caixa de diálogo de chat -->
    <a-box id="chat-box" position="0 1.5 -2.5" width="2" height="1.5" depth="0.1" color="#333" visible="false">
      <a-text id="dialogue" value="" position="0 0.5 0.05" width="1.8" color="#FFFFFF" visible="false" align="center"></a-text>

      <!-- Opções de resposta -->
      <a-text id="option1" value="1. 7" position="0 0.2 0.05" width="1.8" color="#FFFFFF" visible="false" align="center"></a-text>
      <a-text id="option2" value="2. 8" position="0 0 0.05" width="1.8" color="#FFFFFF" visible="false" align="center"></a-text>
      <a-text id="option3" value="3. 9" position="0 -0.2 0.05" width="1.8" color="#FFFFFF" visible="false" align="center"></a-text>

      <!-- Texto de resposta final -->
      <a-text id="response" value="" position="0 -0.6 0.05" width="1.8" color="#00FF00" visible="false" align="center"></a-text>
    </a-box>

    <script>
      // Função de detecção de proximidade e controle de espaço
      document.querySelector('a-scene').addEventListener('loaded', function () {
        const player = document.querySelector('#player');
        const npc = document.querySelector('#npc');
        const chatBox = document.querySelector('#chat-box');
        const dialogueText = document.querySelector('#dialogue');
        const responseText = document.querySelector('#response');
        const options = [
          document.querySelector('#option1'),
          document.querySelector('#option2'),
          document.querySelector('#option3')
        ];

        let questionAsked = false;
        let chatVisible = false;
        let selectedOption = 1; // Opção inicial selecionada

        // Alterna visibilidade da caixa de chat
        function toggleChatBox() {
          chatVisible = !chatVisible;
          chatBox.setAttribute('visible', chatVisible);
          if (chatVisible) {
            askQuestion();
          } else {
            resetChat();
          }
        }

        // Função para fazer a pergunta e exibir opções
        function askQuestion() {
          dialogueText.setAttribute('value', 'Qual é o resultado de 5 + 3?');
          dialogueText.setAttribute('visible', 'true');
          options.forEach(option => option.setAttribute('visible', 'true'));
          highlightOption(selectedOption);
        }

        // Função para resetar a caixa de chat
        function resetChat() {
          questionAsked = false;
          selectedOption = 1;
          dialogueText.setAttribute('visible', 'false');
          responseText.setAttribute('visible', 'false');
          options.forEach(option => option.setAttribute('visible', 'false'));
        }

        // Função para dar a resposta baseada na opção selecionada
        function giveAnswer(selected) {
          dialogueText.setAttribute('visible', 'false');
          options.forEach(option => option.setAttribute('visible', 'false'));
          responseText.setAttribute('visible', 'true');

          if (selected === 2) { // Opção correta é a 2 (8)
            responseText.setAttribute('value', 'Correto! 5 + 3 = 8');
          } else {
            responseText.setAttribute('value', 'Incorreto. Tente novamente.');
          }

          setTimeout(() => {
            responseText.setAttribute('visible', 'false');
            questionAsked = false;
          }, 3000);
        }

        // Destaca a opção selecionada
        function highlightOption(index) {
          options.forEach((option, i) => {
            option.setAttribute('color', i === index - 1 ? '#FFFF00' : '#FFFFFF');
          });
        }

        // Listener para detectar o pressionamento da barra de espaço e setas do teclado
        window.addEventListener('keydown', (event) => {
          if (event.code === 'Space') {
            toggleChatBox();
          }
          if (chatVisible) {
            if (event.code === 'ArrowDown') {
              selectedOption = selectedOption < options.length ? selectedOption + 1 : 1;
              highlightOption(selectedOption);
            } else if (event.code === 'ArrowUp') {
              selectedOption = selectedOption > 1 ? selectedOption - 1 : options.length;
              highlightOption(selectedOption);
            } else if (event.code === 'Enter' && questionAsked) {
              giveAnswer(selectedOption);
            }
          }
        });

        // Verifica a proximidade do jogador com o NPC
        setInterval(function () {
          const playerPos = player.object3D.position;
          const npcPos = npc.object3D.position;
          const distance = playerPos.distanceTo(npcPos);

          if (distance < 1.5 && chatVisible && !questionAsked) {
            questionAsked = true;
            askQuestion();
          }
        }, 500);
      });
    </script>
  </a-scene>
</body>
</html>
